<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
  <head>
    <title>Visualizando Imagens OpenCV no GDB</title>
    <meta charset="utf-8" />
    <link rel="stylesheet" type="text/css" href="http://www.renatogarcia.blog.br//media/css/style.css" />
    <link rel="stylesheet" type="text/css" href="http://www.renatogarcia.blog.br//media/css/code.css" />
  </head>
  <body>

    <div class="page">

      <div class="header">
        <span class="title">Renato Garcia</span>
        <ul>
          
          <li class="selected"><a href="http://www.renatogarcia.blog.br//pt/index.html">Blog</a></li>
          <li ><a href="http://www.renatogarcia.blog.br//pt/projetos.html">Projetos</a></li>
          <li ><a href="http://www.renatogarcia.blog.br//pt/sobre.html">Sobre</a></li>
          
        </ul>
      </div>

      <div class="page_body">
        <div class="translation">
          
            <a href=http://www.renatogarcia.blog.br/en/posts/visualizing_opencv_images_on_gdb.html>English
            
          </a>
        </div>
        
<div class="post">
  <h1>Visualizando Imagens OpenCV no GDB</h1>
  
  <div class="post_date">02 de outubro de 2014</div>
  
  <p>Ao se debugar um programa usando o GDB ou qualquer outro debugador, se uma
determinada variável representar uma imagem, inspecioná-la simplesmente
imprimindo seu conteúdo como uma sequência de números ou caracteres não é lá de
muita utilidade.</p>
<div class="figure">
<img alt="../../media/img/woman_in_red_bin.png" src="../../media/img/woman_in_red_bin.png" />
<p class="caption">A não ser que você esteja vendo uma mulher de vermelho, o resultado acima
não deve ter lhe acrescentado muita informação sobre o estado da variável
<code>matImg</code>.</p>
</div>
<p>Uma alternativa um pouco melhor do que simplesmente imprimir uma imagem como uma
sequência de bytes, seria uma variação de <em>printf debugging</em>. Usando as funções
da biblioteca OpenCV como exemplo, o código abaixo irá exibir em uma janela a
imagem que está na variável <code>mat</code>, e esperar até que uma tecla qualquer
seja pressionada.</p>
<div class="code_box"><pre><span class="n">cv</span><span class="o">::</span><span class="n">imshow</span><span class="p">(</span><span class="s">&quot;window&quot;</span><span class="p">,</span> <span class="n">mat</span><span class="p">);</span>
<span class="n">cv</span><span class="o">::</span><span class="n">waitKey</span><span class="p">();</span>
</pre><div class="caption"><span class="code_language">C++</span></div></div><p>É simples, funciona, mas possui todas as mesmas desvantagens da técnica de
<em>printf debugging</em> tradicional. A solução ideal seria obter o mesmo resultado
acima, mas através de um comando interno do GDB.</p>
<p>Tentando não acabar reinventando a roda sem saber, depois de um tempo de
pesquisa encontrei uma extensão para o GDB, criada por Stefano Pellegrini, que
fazia boa parte do que eu desejava para objetos do tipo <code>cv::Mat</code>. Beleza!
Partindo dessa versão, acrescentei suporte para IplImage, ROIs, alguns outros
detalhes, e tenho agora uma forma bem razoável de debugar programas que usam
imagens da OpenCV.</p>
<div class="figure">
<img alt="../../media/img/48072cfb-aa5f-4624-8d73-c0f2d69a33ad_2.png" src="../../media/img/48072cfb-aa5f-4624-8d73-c0f2d69a33ad_2.png" />
<p class="caption">Uma vez a extensão instalada, haverá um novo comando do GDB que exibirá a
imagem em uma janela.</p>
</div>
<p>Esta extensão irá registrar um novo comando, <code>cv_imshow</code>, que recebe como
argumento uma variável contendo a imagem que deverá ser exibida. A princípio
cogitei usar o mecanismo de <a class="reference external" href="http://sourceware.org/gdb/current/onlinedocs/gdb/Pretty-Printing.html#Pretty-Printing">pretty printing</a> ao invés de criar um novo
comando, mas não teria sido a melhor decisão. Mesmo restrito aos tipos de imagem
da OpenCV, nem todos os formatos são passíveis de serem exibidos. Portanto ainda
é útil que se tenha ao menos o comando de <code>print</code> tradicional do GDB, como
um último recuso para inspecionar uma variável caso ela não possa ser
inspecionada graficamente.</p>
<p>O código fonte, juntamente com todas as instruções para compilar e instalar a
extensão podem ser encontrados (em inglês) no <a class="reference external" href="https://github.com/renatoGarcia/gdb-imshow">repositório github</a> do projeto.</p>

</div>
<div id="disqus_thread"></div>
<script type="text/javascript">
  var disqus_shortname = 'renatogarciablog';
  var disqus_identifier = '48072cfb-aa5f-4624-8d73-c0f2d69a33ad-pt';
  <!-- var disqus_url = 'http://renatogarcia.blog.br//home/renatofg/programming/blog_caligari/content/pt/posts/visualizando_imagens_opencv_no_gdb.rst'; -->
  var disqus_developer = 0; // if 1 developer mode is on
  var disqus_title = 'Visualizando Imagens OpenCV no GDB';

  (function() {
  var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
  dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
  (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>

      </div>

      </div>
    </body>
  </html>